I/PRP 've/VBP written/VBN this/DT little/JJ function/NN several/JJ years/NNS ago/RB :/: function/NN sqlvprintf/COB -LRB-/COB $/COB query/COB ,/COB $/COB args/COB -RRB-/COB -LCB-/COB global/COB $/COB DB_LINK/COB ;/COB $/COB ctr/COB =/COB 0/COB ;/COB ensureConnection/COB -LRB-/COB -RRB-/COB ;/COB //COB //COB Connect/VB to/TO database/NN if/IN not/RB connected/VBN already/RB ./.
$/COB values/COB =/COB array/COB -LRB-/COB -RRB-/COB ;/COB foreach/COB -LRB-/COB $/COB args/COB as/COB $/COB value/COB -RRB-/COB -LCB-/COB if/COB -LRB-/COB is_string/COB -LRB-/COB $/COB value/COB -RRB-/COB -RRB-/COB -LCB-/COB $/COB value/COB =/COB ''/COB '/COB ''/COB ./COB
mysqli_real_escape_string/COB -LRB-/COB $/COB DB_LINK/COB ,/COB $/COB value/COB -RRB-/COB ./COB ''/COB '/COB ''/COB
;/COB -RCB-/COB else/COB if/COB -LRB-/COB is_null/COB -LRB-/COB $/COB value/COB -RRB-/COB -RRB-/COB -LCB-/COB $/COB value/COB =/COB `/COB NULL/COB '/COB ;/COB -RCB-/COB else/COB if/COB -LRB-/COB !/COB
is_int/COB -LRB-/COB $/COB value/COB -RRB-/COB &/COB &/COB !/COB
is_float/COB -LRB-/COB $/COB value/COB -RRB-/COB -RRB-/COB -LCB-/COB die/COB -LRB-/COB `/COB Only/RB numeric/JJ ,/, string/NN ,/, array/NN and/CC NULL/COS arguments/NNS allowed/VBN in/IN a/DT query/NN ./.
Argument/COB '/COB ./COB
-LRB-/COB $/COB ctr/COB +1/COB -RRB-/COB ./COB '/COB
is/VBZ not/RB a/DT basic/JJ type/NN ,/, it/PRP \/SYM 's/POS type/NN is/VBZ '/COB ./COB
gettype/COB -LRB-/COB $/COB value/COB -RRB-/COB ./COB '/COB ./COB '/COB -RRB-/COB
;/COB -RCB-/COB $/COB values/COB -LSB-/COB -RSB-/COB =/COB $/COB value/COB ;/COB $/COB ctr/COB +/COB +/COB ;/COB -RCB-/COB $/COB query/COB =/COB preg_replace_callback/COB -LRB-/COB '/COB //COB -LCB-/COB -LRB-/COB \/COB \/COB d/COB +/COB -RRB-/COB -RCB-/COB //COB '/COB ,/COB function/COB -LRB-/COB $/COB match/COB -RRB-/COB use/COB -LRB-/COB $/COB values/COB -RRB-/COB -LCB-/COB if/COB -LRB-/COB isset/COB -LRB-/COB $/COB values/COB -LSB-/COB $/COB match/COB -LSB-/COB 1/COB -RSB-/COB -RSB-/COB -RRB-/COB -RRB-/COB -LCB-/COB return/COB $/COB values/COB -LSB-/COB $/COB match/COB -LSB-/COB 1/COB -RSB-/COB -RSB-/COB ;/COB -RCB-/COB else/COB -LCB-/COB return/COB $/COB match/COB -LSB-/COB 0/COB -RSB-/COB ;/COB -RCB-/COB -RCB-/COB ,/COB $/COB query/COB -RRB-/COB ;/COB return/COB $/COB query/COB ;/COB -RCB-/COB function/COB runEscapedQuery/COB -LRB-/COB $/COB preparedQuery/COB //COB */COB ,/COB .../COB */COB //COB -RRB-/COB -LCB-/COB $/COB params/COB =/COB array_slice/COB -LRB-/COB func_get_args/COB -LRB-/COB -RRB-/COB ,/COB 1/COB -RRB-/COB ;/COB $/COB results/COB =/COB runQuery/COB -LRB-/COB sqlvprintf/COB -LRB-/COB $/COB preparedQuery/COB ,/COB $/COB params/COB -RRB-/COB -RRB-/COB ;/COB //COB //COB Run/VBP query/NN and/CC fetch/VBP results/NNS ./.
return/COB $/COB results/COB ;/COB -RCB-/COB This/DT allows/VBZ running/VBG statements/NNS in/IN an/DT one-liner/NN C#/ACR -/: ish/FW String.Format/COS like/IN :/: runEscapedQuery/COB -LRB-/COB ``/COB INSERT/COB INTO/COB Whatever/COB -LRB-/COB id/COB ,/COB foo/COB ,/COB bar/COB -RRB-/COB VALUES/COB -LRB-/COB -LCB-/COB 0/COB -RCB-/COB ,/COB -LCB-/COB 1/COB -RCB-/COB ,/COB -LCB-/COB 2/COB -RCB-/COB -RRB-/COB ''/COB ,/COB $/COB numericVar/COB ,/COB $/COB stringVar1/COB ,/COB $/COB stringVar2/COB -RRB-/COB ;/COB It/PRP escapes/VBZ considering/VBG the/DT variable/JJ type/NN ./.
If/IN you/PRP try/VBP to/TO parameterize/VB table/NN ,/, column/NN names/NNS ,/, it/PRP would/MD fail/VB as/IN it/PRP puts/VBZ every/DT string/NN in/IN quotes/NNS which/WDT is/VBZ invalid/JJ syntax/NN ./.
SECURITY/NN UPDATE/VB :/: The/DT previous/JJ str_replace/COS version/NN allowed/VBD injections/NNS by/IN adding/VBG -LCB-/-LRB- #/COS -RCB-/-RRB- tokens/NNS into/IN user/NN data/NNS ./.
This/DT preg_replace_callback/COS version/NN does/VBZ n't/RB cause/VB problems/NNS if/IN the/DT replacement/NN contains/VBZ these/DT tokens/NNS ./.
@YourCommonSense/ATS Hmmm/UH sprintf/COS is/VBZ useful/JJ ./.
But/CC not/RB necessarily/RB here/RB ,/, as/IN strings/NNS need/VBP to/TO be/VB properly/RB escaped/VBN and/CC wrapped/VBN with/IN quotes/NNS ./.
If/IN the/DT caller/NN casts/VBZ the/DT parameter/NN to/TO int/COS it/PRP wo/MD n't/RB get/VB quoted/VBN so/IN it/PRP can/MD be/VB used/VBN with/IN the/DT LIMIT/COS clause/NN as/RB well/RB ./. ./.
@YourCommonSense/ATS Whatever/WDT SQL/ACR preparing/VBG library/NN you/PRP use/VBP you/PRP 'll/MD need/VB to/TO tell/VB it/PRP somehow/RB how/WRB to/TO handle/VB the/DT supplied/VBN parameters/NNS ./.
If/IN it/PRP maps/VBZ to/TO the/DT SQL/ACR prepare/VB statement/NN ,/, you/PRP still/RB need/VB to/TO tell/VB it/PRP whether/IN it/PRP should/MD quote/VB the/DT value/NN or/CC not/RB -LRB-/-LRB- string/NN or/CC number/NN -RRB-/-RRB- ./.
Otherwise/RB it/PRP will/MD need/VB to/TO parse/VB the/DT statement/NN and/CC decide/VB based/VBN on/IN that/DT ./.
Anyway/RB MySQL/ACR is/VBZ happy/JJ if/IN you/PRP quote/VBP everything/NN ./.
@Kermani/ATS It/PRP escapes/VBZ quotes/NNS correctly/RB ./.
If/IN you/PRP can/MD find/VB a/DT security/NN hole/NN in/IN it/PRP ,/, let/VB me/PRP know/VB ./.
