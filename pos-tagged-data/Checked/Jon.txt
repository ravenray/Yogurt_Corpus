@martinstoeckli/ATS :/: That/DT change/NN also/RB makes/VBZ a/DT difference/NN for/IN the/DT answers/NNS :-RRB-/EMO @martinstoeckli/ATS :/: I/PRP have/VBP updated/VBN the/DT answer/NN to/TO cover/VB the/DT current/JJ question/NN ./.
Updated/JJ answer/NN The/DT question/NN was/VBD edited/VBN -LRB-/-LRB- after/IN my/PRP$ answer/NN was/VBD posted/VBN -RRB-/-RRB- to/TO specifically/RB target/VB mysqli_escape_string/COS ,/, which/WDT is/VBZ an/DT alias/NN of/IN mysql_real_escape_string/COS and/CC therefore/RB takes/VBZ the/DT connection/NN encoding/VBG into/IN account/NN ./.
This/DT makes/VBZ the/DT original/JJ answer/NN non-applicable/JJ anymore/RB ,/, but/CC I/PRP 've/VBP left/VBN it/PRP for/IN completeness/NN ./.
The/DT new/JJ answer/NN ,/, in/IN short/JJ :/: mysqli_escape_string/COS is/VBZ as/IN good/JJ security-wise/NN as/IN parameterized/JJ queries/NNS ,/, provided/VBN you/PRP do/VBP n't/RB shoot/VB yourself/PRP in/IN the/DT foot/NN ./.
Specifically/RB ,/, what/WP you/PRP must/MD not/RB do/VB is/VBZ highlighted/VBN in/IN the/DT giant/JJ warning/NN on/IN the/DT PHP/ACR doc/NN page/NN :/: he/PRP character/NN set/NN must/MD be/VB set/VBN either/CC at/IN the/DT server/NN level/NN ,/, or/CC with/IN the/DT API/ACR function/NN mysqli_set_charset/COS -LRB-/COS -RRB-/COS for/IN it/PRP to/TO affect/VB mysqli_real_escape_string/COS -LRB-/COS -RRB-/COS ./.
If/IN you/PRP do/VBP n't/RB heed/VB this/DT warning/NN -LRB-/-LRB- i.e./FW if/IN you/PRP change/VBP the/DT character/NN set/VBN with/IN a/DT direct/JJ SET/COS NAMES/COS query/NN -RRB-/-RRB- and/CC you/PRP change/VBP the/DT character/NN set/VBN from/IN a/DT single-byte/JJ encoding/NN to/TO a/DT ``/`` convenient/JJ ''/'' -LRB-/-LRB- from/IN the/DT attacker/NN 's/POS perspective/NN -RRB-/-RRB- multibyte/JJ encoding/NN ,/, you/PRP will/MD have/VB in/IN effect/NN emulated/VBD what/WP the/DT dumb/JJ mysql_escape_string/COS does/VBZ :/: attempt/VB to/TO escape/VB characters/NNS without/IN knowing/VBG which/WDT encoding/VBG the/DT input/NN is/VBZ in/IN ./.
This/DT situation/NN leaves/VBZ you/PRP potentially/RB vulnerable/JJ to/TO SQL/ACR injection/NN as/IN described/VBN by/IN the/DT original/JJ answer/NN below/IN ./.
Important/JJ note/NN :/: I/PRP remember/VBP reading/VBG somewhere/RB that/IN recent/JJ MySql/NNP versions/NNS have/VBP plugged/VBN this/DT hole/NN on/IN their/PRP$ end/NN -LRB-/-LRB- in/IN the/DT client/NN libraries/NNS ?/. -RRB-/-RRB-
,/, which/WDT means/VBZ that/IN you/PRP might/MD be/VB perfectly/RB safe/JJ even/RB if/IN using/VBG SET/COS NAMES/COS to/TO switch/VB to/TO a/DT vulnerable/JJ multibyte/JJ encoding/NN ./.
But/CC please/VB do/VBP n't/RB take/VB my/PRP$ word/NN for/IN it/PRP ./.
Original/JJ answer/NN In/IN contrast/NN to/TO mysql_real_escape_string/COS ,/, the/DT bare/JJ mysql_escape_string/COS does/VBZ not/RB take/VB into/IN account/NN the/DT connection/NN encoding/NN ./.
This/DT means/VBZ that/IN it/PRP assumes/VBZ the/DT input/NN is/VBZ in/IN a/DT single-byte/JJ encoding/NN ,/, when/WRB in/IN fact/NN it/PRP can/MD legitimately/RB be/VB in/IN a/DT multibyte/JJ encoding/NN ./.
Some/DT multibyte/JJ encodings/NNS have/VBP byte/NN sequences/NNS that/WDT correspond/VBP to/TO a/DT single/JJ character/NN where/WRB one/CD of/IN the/DT bytes/NNS is/VBZ the/DT ASCII/ACR value/NN of/IN the/DT single/JJ quote/NN -LRB-/-LRB- 0x27/COS -RRB-/-RRB- ;/: if/IN fed/VBN such/PDT a/DT string/NN ,/, mysql_escape_string/COS will/MD happily/RB ``/`` escape/VB the/DT quote/NN ''/'' ,/, which/WDT means/VBZ substituting/VBG 0x27/COS with/IN 0x5c/COS 0x27/COS ./.
Depending/VBG on/IN the/DT encoding/JJ rules/NNS ,/, this/DT could/MD result/VB in/IN mutating/VBG the/DT multibyte/JJ character/NN into/IN another/DT that/WDT includes/VBZ the/DT 0x5c/COS and/CC leaving/VBG the/DT ``/`` remaining/JJ ''/'' 0x27/COS as/IN a/DT stand-alone/JJ single/JJ quote/NN in/IN the/DT input/NN ./.
Voil√†/FW ,/, you/PRP have/VBP injected/VBN an/DT unescaped/JJ quote/NN into/IN the/DT SQL/ACR ./.
For/IN more/JJR details/NNS see/VBP this/DT blog/NN post/NN ./.
@Asad/ATS :/: You/PRP specifically/RB did/VBD not/RB ask/VB for/IN something/NN like/IN that/DT ,/, so/IN I/PRP guess/VBP it/PRP 's/VBZ your/PRP$ fault/NN :-RRB-/EMO @Asad/ATS :/: Sure/RB ,/, just/RB joking/VBG :-RRB-/EMO
