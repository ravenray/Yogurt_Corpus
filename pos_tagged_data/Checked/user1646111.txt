regarding/IN to/TO optimization/NN by/IN prepared/JJ statement/NN ,/, the/DT only/JJ thing/NN that/IN SQL/ACR server/NN will/MD do/VB is/VBZ -LRB-/-LRB- Escaping/VBG the/DT string/NN at/IN server/NN side/NN -RRB-/-RRB- nothing/NN else/RB ,/, in/IN other/JJ words/NNS ,/, if/IN you/PRP can/MD escape/VB properly/RB ,/, it/PRP s/VBZ similar/JJ to/TO prepared/JJ statement/NN but/CC without/IN optimization/NN ./.
Regarding/VBG to/TO many/JJ useful/JJ answers/NNS ,/, I/PRP hope/VBP to/TO add/VB some/DT values/NNS to/TO this/DT thread/NN ./.
SQL/ACR injection/NN is/VBZ type/NN of/IN attack/NN that/WDT can/MD be/VB done/VBN through/IN user/NN inputs/NNS -LRB-/-LRB- Inputs/NNS that/IN filled/VBN by/IN user/NN and/CC then/RB used/VBN inside/IN queries/NNS -RRB-/-RRB- ,/, The/DT SQL/ACR injection/NN patterns/NNS are/VBP correct/JJ query/JJ syntax/NN while/IN we/PRP can/MD call/VB it/PRP :/: bad/JJ queries/NNS for/IN bad/JJ reasons/NNS ,/, we/PRP assume/VBP that/IN there/EX might/MD be/VB bad/JJ person/NN that/WDT try/VBP to/TO get/VB secret/JJ information/NN -LRB-/-LRB- by/IN passing/VBG access/NN control/NN -RRB-/-RRB- that/WDT affect/VBP the/DT three/CD principles/NNS of/IN security/NN -LRB-/-LRB- Confidentiality/NN ,/, Integrity/NN ,/, Availability/NN -RRB-/-RRB- ./.
Now/RB ,/, our/PRP$ point/NN is/VBZ to/TO prevent/VB security/NN threats/NNS such/JJ as/IN SQL/ACR injection/NN attacks/NNS ,/, the/DT question/NN asking/NN -LRB-/-LRB- How/WRB to/TO prevent/VB SQL/ACR injection/NN attack/NN using/VBG PHP/ACR -RRB-/-RRB- ,/, be/VB more/RBR realistic/JJ ,/, data/NNS filtering/VBG or/CC clearing/VBG input/NN data/NNS is/VBZ the/DT case/NN when/WRB using/VBG user-input/JJ data/NNS inside/IN such/JJ query/NN ,/, using/VBG PHP/ACR or/CC any/DT other/JJ programming/NN language/NN is/VBZ not/RB the/DT case/NN ,/, or/CC as/IN recommended/VBN by/IN more/JJR people/NNS to/TO use/VB modern/JJ technology/NN such/JJ as/IN prepared/JJ statement/NN or/CC any/DT other/JJ tools/NNS that/WDT currently/RB supporting/VBG SQL/ACR injection/NN prevention/NN ,/, consider/VBP that/IN these/DT tools/NNS not/RB available/JJ anymore/RB ?/.
how/WRB you/PRP secure/VBP your/PRP$ application/NN ?/.
My/PRP$ approach/NN against/IN SQL/ACR injection/NN is/VBZ :/: clearing/VBG user-input/JJ data/NNS before/IN sending/VBG it/PRP to/TO database/NN -LRB-/-LRB- before/IN using/VBG it/PRP inside/IN any/DT query/NN -RRB-/-RRB- ./.
Data/NNS filtering/VBG for/IN -LRB-/-LRB- Converting/VBG unsafe/JJ data/NNS to/TO safe/JJ data/NNS -RRB-/-RRB- Consider/VBP that/IN PDO/ACR and/CC MySQLi/COS not/RB available/JJ ,/, how/WRB can/MD you/PRP secure/VB your/PRP$ application/NN ?/.
do/VB you/PRP force/VB me/PRP to/TO use/VB them/PRP ?/.
what/WP about/IN other/JJ languages/NNS other/JJ than/IN PHP/ACR ?/.
I/PRP prefer/VBP to/TO provide/VB general/JJ ideas/NNS as/IN it/PRP can/MD be/VB used/VBN for/IN wider/JJR border/NN not/RB just/RB for/IN specific/JJ language/NN ./.
SQL/ACR user/NN -LRB-/-LRB- limiting/VBG user/NN privilege/NN -RRB-/-RRB- :/: most/RBS common/JJ SQL/ACR operations/NNS are/VBP -LRB-/-LRB- SELECT/COS ,/, UPDATE/COS ,/, INSERT/COS -RRB-/-RRB- ,/, then/RB ,/, why/WRB giving/VBG UPDATE/COS privilege/NN to/TO a/DT user/NN that/WDT not/RB require/VB it/PRP ?/.
for/IN example/NN :/: login/NN ,/, and/CC search/NN pages/NNS are/VBP only/RB using/VBG SELECT/COS ,/, then/RB ,/, why/WRB using/VBG db/ACR users/NNS in/IN these/DT pages/NNS with/IN high/JJ privileges/NNS ?/.
RULE/NN :/: do/VBP not/RB create/VB one/CD database/NN user/NN for/IN all/DT privileges/NNS ,/, for/IN all/DT SQL/ACR operations/NNS ,/, you/PRP can/MD create/VB your/PRP$ scheme/NN like/IN -LRB-/-LRB- deluser/COS ,/, selectuser/COS ,/, updateuser/COS -RRB-/-RRB- as/IN usernames/NNS for/IN easy/JJ usage/NN ./.
see/VB Principle/NN of/IN least/JJS privilege/NN Data/NN filtering/VBG :/: before/IN building/VBG any/DT query/NN user/NN input/NN should/MD be/VB validated/VBN and/CC filtered/VBN ,/, for/IN programmers/NNS ,/, it/PRP 's/VBZ important/JJ to/TO define/VB some/DT properties/NNS for/IN each/DT user-input/JJ variables/NNS :/: data/NNS type/NN ,/, data/NN pattern/NN ,/, and/CC data/NNS length/NN ./.
a/DT field/NN that/WDT is/VBZ a/DT number/NN between/IN -LRB-/-LRB- x/NN and/CC y/NN -RRB-/-RRB- must/MD be/VB exactly/RB validated/VBN using/VBG exact/JJ rule/NN ,/, for/IN a/DT field/NN that/WDT is/VBZ a/DT string/NN -LRB-/-LRB- text/NN -RRB-/-RRB- :/: pattern/NN is/VBZ the/DT case/NN ,/, for/IN example/NN :/: username/NN must/MD contain/VB only/RB some/DT characters/NNS lets/VBZ say/VB -LSB-/-LRB- a-zA-Z0-9/COS _/COS -/COS ./COS -RSB-/-RRB-
the/DT length/NN vary/VBP between/IN -LRB-/-LRB- x/NN and/CC n/NN -RRB-/-RRB- where/WRB x/NN and/CC n/NN -LRB-/-LRB- integers/NNS ,/, x/NN </SYM =/SYM n/NN -RRB-/-RRB- ./.
Rule/NN :/: creating/VBG exact/JJ filters/NNS and/CC validation/NN rules/NNS are/VBP best/JJS practice/NN for/IN me/PRP ./.
Use/VBP other/JJ tools/NNS :/: Here/RB ,/, I/PRP will/MD also/RB agree/VB with/IN you/PRP that/IN prepared/JJ statement/NN -LRB-/-LRB- parametrized/JJ query/NN -RRB-/-RRB- and/CC Stored/JJ procedures/NNS ,/, the/DT disadvantages/NNS here/RB is/VBZ these/DT ways/NNS requires/VBZ advanced/JJ skills/NNS which/WDT are/VBP not/RB exist/VBP in/IN most/JJS users/NNS ,/, the/DT basic/JJ idea/NN here/RB is/VBZ to/TO distinguish/VB between/IN SQL/ACR query/NN and/CC the/DT data/NNS that/IN being/VBG used/VBN inside/RB ,/, both/DT approach/NN can/MD be/VB used/VBN even/RB with/IN unsafe/JJ data/NNS ,/, because/IN the/DT user-input/NN data/NNS here/RB not/RB add/VB anything/NN to/TO the/DT original/JJ query/NN such/JJ as/IN -LRB-/-LRB- any/DT or/CC x/NN =/SYM x/NN -RRB-/-RRB- ./.
for/IN more/JJR information/NN please/VB read/VBN OWASP/ARC SQL/ARC Injection/NN Prevention/NN Cheat/NN Sheet/NN ./.
Now/RB ,/, if/IN you/PRP are/VBP an/DT advanced/JJ user/NN ,/, start/NN using/VBG these/DT defense/NN as/IN you/PRP like/VBP ,/, but/CC ,/, for/IN beginners/NNS ,/, if/IN they/PRP ca/MD n't/RB quickly/RB implement/VB stored/JJ procedure/NN and/CC prepared/JJ statement/NN ,/, it/PRP 's/VBZ better/JJR to/TO filter/NN input/NN data/NNS as/RB much/RB they/PRP can/MD ./.
Finally/RB ,/, let/VB 's/POS consider/VB that/DT user/NN sends/VBZ this/DT text/NN below/IN instead/RB of/IN entering/VBG his/PRP$ username/NN :/: -LSB-/COB 1/COB -RSB-/COB UNION/COB SELECT/COB IF/COB -LRB-/COB SUBSTRING/COB -LRB-/COB Password/COB ,1,1/COB -RRB-/COB =/COB '/COB 2/COB '/COB ,/COB BENCHMARK/COB -LRB-/COB 100000/COB ,/COB SHA1/COB -LRB-/COB 1/COB -RRB-/COB -RRB-/COB ,0/COB -RRB-/COB User/COB ,/COB Password/COB FROM/COB mysql.user/COB WHERE/COB User/COB =/COB `/COB root/COB '/COB This/DT input/NN can/MD be/VB checked/VBN early/RB without/IN any/DT prepared/JJ statement/NN and/CC stored/JJ procedures/NNS ,/, but/CC to/TO be/VB on/IN safe/JJ side/NN ,/, using/VBG them/PRP starts/VBZ after/IN user-data/NN filtering/VBG and/CC validation/NN ./.
Last/JJ point/NN is/VBZ detecting/VBG unexpected/JJ behavior/NN which/WDT requires/VBZ more/JJR effort/NN and/CC complexity/NN ,/, it/PRP 's/VBZ not/RB recommended/VBN for/IN normal/JJ web/NN applications/NNS ./.
Unexpected/JJ behavior/NN in/IN above/JJ user/NN input/NN is/VBZ :/: SELECT/COS ,/, UNION/COS ,/, IF/COS ,/, SUBSTRING/COS ,/, BENCHMARK/COS ,/, SHA/COS ,/, root/COS once/RB these/DT words/NNS detected/VBD ,/, you/PRP can/MD avoid/VB the/DT input/NN ./.
UPDATE1/NN :/: A/DT user/NN commented/VBD that/IN this/DT post/NN is/VBZ useless/JJ ,/, OK/UH !/.
Here/RB is/VBZ what/WDT OWASP.ORG/URL provided/VBD :/: Primary/JJ defenses/NNS :/: Option/NN #/# 1/CD :/: Use/VBP of/IN Prepared/JJ Statements/NN -LRB-/-LRB- Parameterized/JJ Queries/NNS -RRB-/-RRB- Option/NN #/# 2/CD :/: Use/VBP of/IN Stored/JJ Procedures/NNS Option/NN #/# 3/CD :/: Escaping/VBG all/DT User/NN Supplied/JJ Input/NN Additional/JJ defenses/NNS :/: Also/RB Enforce/VB :/: Least/DT Privilege/NN Also/RB Perform/VB :/: White/JJ List/NN Input/NN Validation/NN As/IN you/PRP may/MD knew/VBD ,/, claiming/VBG on/IN any/DT article/NN should/MD be/VB supported/VBN by/IN valid/JJ argument/NN ,/, at/IN least/JJS one/CD reference/NN !/.
Otherwise/RB it/PRP 's/VBZ considered/VBN as/IN attack/NN and/CC bad/JJ claim/NN !/.
Update2/NN :/: From/IN the/DT PHP/ACR manual/NN ,/, PHP/ACR :/: Prepared/JJ Statements/NNS -/: Manual/NN :/: Escaping/NN and/CC SQL/ACR injection/NN Bound/JJ variables/NNS will/MD be/VB escaped/VBN automatically/RB by/IN the/DT server/NN ./.
The/DT server/NN inserts/NNS their/PRP$ escaped/VBN values/NNS at/IN the/DT appropriate/JJ places/NNS into/IN the/DT statement/NN template/NN before/IN execution/NN ./.
A/DT hint/NN must/MD be/VB provided/VBN to/TO the/DT server/NN for/IN the/DT type/NN of/IN bound/VBN variable/NN ,/, to/TO create/VB an/DT appropriate/JJ conversion/NN ./.
See/VB the/DT mysqli_stmt_bind_param/COS -LRB-/COS -RRB-/COS function/NN for/IN more/JJR information/NN ./.
The/DT automatic/JJ escaping/VBG of/IN values/NNS within/IN the/DT server/NN is/VBZ sometimes/RB considered/VBN a/DT security/NN feature/NN to/TO prevent/VB SQL/ACR injection/NN ./.
The/DT same/JJ degree/NN of/IN security/NN can/MD be/VB achieved/VBN with/IN non-prepared/JJ statements/NNS ,/, if/IN input/NN values/NNS are/VBP escaped/VBN correctly/RB ./.
Update3/NN :/: I/PRP created/VBD test/NN cases/NNS for/IN knowing/VBG how/WRB PDO/ACR and/CC MySQLi/COS sends/VBZ the/DT query/NN to/TO MySQL/COS server/NN when/WRB using/VBG prepared/JJ statement/NN :/: PDO/ACR :/: $/COB user/COB =/COB ''/COB ''/COB 1/COB ''/COB ''/COB ;/COB //COB //COB Malicious/COB keyword/COB $/COB sql/COB =/COB `/COB SELECT/COB */COB FROM/COB awa_user/COB WHERE/COB userame/COB =/COB :/COB username/COB '/COB ;/COB $/COB sth/COB =/COB $/COB dbh/COB -/COB >/COB prepare/COB -LRB-/COB $/COB sql/COB ,/COB array/COB -LRB-/COB PDO/COB :/COB :/COB ATTR_CURSOR/COB =/COB >/COB PDO/COB :/COB :/COB CURSOR_FWDONLY/COB -RRB-/COB -RRB-/COB ;/COB $/COB sth/COB -/COB >/COB execute/COB -LRB-/COB array/COB -LRB-/COB '/COB :/COB username/COB '/COB =/COB >/COB $/COB user/COB -RRB-/COB -RRB-/COB ;/COB Query/COB Log/COB :/COB 189/COB Query/COB SELECT/COB */COB FROM/COB awa_user/COB WHERE/COB userame/COB ='\/COB '/COB \/COB '/COB 1/COB \/COB '/COB \/COB ''/COB 189/COB Quit/COB MySQLi/COB :/COB $/COB stmt/COB =/COB $/COB mysqli/COB -/COB >/COB prepare/COB -LRB-/COB ``/COB SELECT/COB */COB FROM/COB awa_user/COB WHERE/COB username/COB =/COB ?/COB ''/COB -RRB-/COB -RRB-/COB
-LCB-/COB $/COB stmt/COB -/COB >/COB bind_param/COB -LRB-/COB ``/COB s/COB ''/COB ,/COB $/COB user/COB -RRB-/COB ;/COB $/COB user/COB =/COB ''/COB ''/COB 1/COB ''/COB ''/COB ;/COB $/COB stmt/COB -/COB >/COB execute/COB -LRB-/COB -RRB-/COB ;/COB Query/COB Log/COB :/COB 188/COB Prepare/COB SELECT/COB */COB FROM/COB awa_user/COB WHERE/COB username/COB =/COB ?/COB
188/COB Execute/COB SELECT/COB */COB FROM/COB awa_user/COB WHERE/COB username/COB ='\/COB '/COB \/COB '/COB 1/COB \/COB '/COB \/COB ''/COB 188/COB Quit/COB It/PRP 's/VBZ clear/JJ that/IN a/DT prepared/JJ statement/NN is/VBZ also/RB escaping/VBG the/DT data/NNS ,/, nothing/NN else/RB ./.
As/IN also/RB mentioned/VBN in/IN above/JJ statement/NN The/DT automatic/JJ escaping/VBG of/IN values/NNS within/IN the/DT server/NN is/VBZ sometimes/RB considered/VBN a/DT security/NN feature/NN to/TO prevent/VB SQL/ACR injection/NN ./.
The/DT same/JJ degree/NN of/IN security/NN can/MD be/VB achieved/VBN with/IN non-prepared/JJ statements/NNS ,/, if/IN input/NN values/NNS are/VBP escaped/VBN correctly/RB ,/, therefore/RB ,/, this/DT proves/VBZ that/IN data/NNS validation/NN such/JJ as/IN intval/COS -LRB-/COS -RRB-/COS is/VBZ a/DT good/JJ idea/NN for/IN integer/NN values/NNS before/IN sending/VBG any/DT query/NN ,/, in/IN addition/NN ,/, preventing/VBG malicious/JJ user/NN data/NNS before/IN sending/VBG the/DT query/NN is/VBZ correct/JJ and/CC valid/JJ approach/NN ./.
Please/VB see/VB this/DT question/NN for/IN more/JJR detail/NN :/: PDO/ACR sends/VBZ raw/JJ query/NN to/TO MySQL/COS while/IN Mysqli/COS sends/VBZ prepared/JJ query/NN ,/, both/DT produce/VBP the/DT same/JJ result/NN References/NNS :/: SQL/ACR Injection/NN Cheat/JJ Sheet/NN SQL/ACR Injection/NN Information/NN security/NN Security/NN Principles/NNS Data/NN validation/NN @Kobi/ATS :/: I/PRP am/VBP here/RB talking/VBG abour/IN prepared/JJ statement/NN for/IN preventing/VBG SQL/ACR injection/NN ./.
